这份文档专门讲 **主页面里“构造交易/发送交易”的完整使用方法**。我们会把流程写得尽量清晰：你只需要按顺序做，不必了解底层实现。

---

## 1. 一句话理解“构造交易”
你可以把“构造交易”理解为：
> 把你选中的来源地址里的资产（UTXO/TXCer 等）组织起来 → 加上收款信息、Gas、找零 → 在本地签名 → 提交到网络。

所以它会在点击按钮前做很多检查：**余额够不够、地址对不对、找零有没有、Gas 是否足够**……这些都是为了让交易更稳、更安全。

---

## 2. 选择交易模式（非常关键）
PanguPay 在主页面通常会提供三种模式：

### 2.1 普通/快速转账（默认、推荐）
- 支持 **多个收款人**。
- 支持 **多选来源地址**。
- 普通/快速模式通常需要对收款地址进行 **验证（盾牌）**，以便自动获取收款方公钥等信息。

> 你是否看到“普通”还是“快速”，取决于你是否加入了担保组织：  
> 未加入组织：显示“普通转账”；加入组织后：显示“快速转账”，并解锁更多能力。

### 2.2 跨链转账（组织能力）
跨链模式更严格，常见限制：
- **只能有一个收款人**
- 收款地址必须是 **0x 开头的 ETH 格式**
- 金额必须是 **整数**
- 必须选择 **PGC 找零地址**
- 不支持胶囊地址（Capsule）

### 2.3 质押交易（组织能力）
质押属于组织内部能力，面向更特定的业务流程：
- 如果你不确定自己是否需要它，先用普通/快速转账即可。

---

## 3. 一次完整转账：从 0 到提交

### Step 1：选择来源地址（From）
来源地址决定了本次交易“从哪里出钱”：
- 普通/快速转账：支持多选，系统会综合计算余额与 Gas。
- 跨链转账：最终会要求只保留 **一个来源地址**（系统会提示）。

常见小现象（不用紧张）：
- 刚提交过交易时，部分 UTXO 可能会显示“被占用/锁定”，这是为了防止重复花费。

### Step 2：添加收款人（To）
点击“添加”创建一条收款信息。你会看到这些字段：
- 收款地址（必填）
- 金额（必填）
- 币种（必选）
-（展开后）公钥、组织 ID、转账 Gas 等高级字段

#### 2.1 为什么要点“验证（盾牌）”？
在普通/快速转账中，系统需要尽量补全收款方信息（尤其是公钥），否则构造输出时会报错。

推荐的习惯是：
1. 粘贴收款地址
2. 立刻点一下 **盾牌验证**
3. 再填金额和币种

如果你遇到：
- “公钥格式错误/缺失”
- “币种类型不匹配”
- “地址查询失败”

大多数情况下先做两件事：
1. 再点一次盾牌验证
2. 回到主页面刷新后再试

#### 2.2 胶囊地址（Capsule）
如果你输入的是胶囊地址：
- 系统会先要求你“验证胶囊地址”以解析真实地址
- 普通/快速转账支持胶囊地址（跨链不支持）

### Step 3：高级选项（Gas / 找零地址）
高级选项不是“必填”，但它决定了交易的细节行为。

#### 3.1 TX Gas（默认 1）
它是本笔交易的基础 Gas。  
如果你不确定，**保持默认**基本就是最佳选择。

#### 3.2 Extra Gas（可选）
当你填入大于 0 的 Extra Gas 时，系统会要求你确认（避免误操作）。  
它用于补足本次交易所需的 Gas（当可用 Gas 不够时会很有用）。

#### 3.3 找零地址（Change Address）
当你选中的输入总额 > 实际需要支付的金额时，多出来的部分会“找零”回到某个地址。

你会看到按币种划分的找零地址：
- PGC 找零
- BTC 找零
- ETH 找零

一般规则：
- 系统会尽量自动给你选一个可用的找零地址（通常是列表里的第一个）。
- 如果你想指定找零回哪个地址，可以手动切换。

跨链模式额外规则：
- **必须选择 PGC 找零地址**（否则会提示“找零地址缺失/请为跨链交易选择主货币找零地址”）。

### Step 4：点击「构造交易」
点击后系统会做一轮校验，常见校验包括：
- 地址格式是否合法
- 金额是否 > 0（跨链必须为整数）
- 币种选择是否与地址类型一致（普通/快速）
- Gas 是否足够
- 是否存在必需的找零地址

如果你的私钥是加密的，会弹出支付密码输入框：
- 输入正确密码后完成本地签名
- 签名完成后交易会被提交到网络

### Step 5：提交后发生了什么？
提交成功后你可能会看到：
- 按钮短时间不可点击（防止重复提交）
- 部分 UTXO/TXCer 被临时锁定（Pending 期间）
- 历史记录中出现新的交易条目

如果提交失败：
- 系统会提示错误原因
- 被锁定的资源通常会自动解锁（或在短时间后释放）

---

## 4. 两个推荐的“练习关卡”

### 4.1 练习 A：普通/快速转账（PGC → PGC）
1. 选择模式：普通/快速
2. 选择一个有余额的来源地址
3. 添加收款人：粘贴地址 → 点盾牌验证 → 选 PGC → 填金额
4. 直接构造交易（高级选项保持默认）
5. 去交易记录查看状态

### 4.2 练习 B：跨链转账（PGC → 0x...）
1. 确保你已经加入组织，并切到跨链模式
2. 只保留一个来源地址
3. 收款地址必须是 0x 开头（ETH 格式），金额填整数
4. 打开高级选项，选择 PGC 找零地址
5. 构造交易并查看状态

---

## 5. 需要更“硬核”的细节？
如果你是开发者或测试同学，想理解更多实现细节：
- 交易构造与序列化：前端 `js/services/txBuilder.ts`
- 转账校验与模式限制：前端 `js/services/transfer.ts`
- 地址验证（自动补全公钥等）：前端 `js/services/recipient.js`
- 后端相关文档：`UTXO-Area/docs/`（含 TXCer、跨链、网关等专题）

但对于普通用户来说，你只需要记住：**按步骤填 → 盾牌验证 → 保持默认 → 构造交易**，基本就不会出错。
